pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
-- mode7 + details
-- @freds72
-- globals
local _cam,_plyr

local ground_tex=0x0400.0410

function lerp(a,b,t)
	return a*(1-t)+b*t
end

function v_scale(a,scale)
	a[1]*=scale
	a[2]*=scale
end

function v_normz(a)
 local x,y=a[1],a[2]
 local d=sqrt(x*x+y*y)
 return {x/d,y/d},d
end

function v_add(a,b,scale)
	scale=scale or 1
 return {
  a[1]+scale*b[1],
  a[2]+scale*b[2]}
end

-->8
-- camera
function make_cam()	
	local cx,cy,cz=0,2,0
	local a=0
	return {
		track=function(self,pos,angle,dist)
			--a=lerp(a,angle,0.5)
			a=angle
			cx=pos[1]+dist*sin(angle)
 			cz=pos[2]-dist*cos(angle)
		end,
		project=function(self,pos)
		end,
		mode7=function(self,tex)
			poke4(0x5f38,tex)	
			local ca,sa,cy=cos(a),-sin(a),cy*64
			for ye=32,48+64 do
				-- coords in world space
				local rz=cy/(ye-31)
				local x,z=((-ca*rz+sa*rz)<<1)+cx,((sa*rz+ca*rz)<<1)+cz
				tline(0,ye,127,ye,x,z,(ca*rz)>>5,(-sa*rz)>>5)
			end
 			poke4(0x5f38,0)
		end
	}
end

function make_player(pos)
	local acc=0
	-- camera pos
	local da,angle=0,0
	local v={0,0}

	return {
		orientation=function(self)
			return pos,angle,da
		end,
		update=function(self)
			--angle*=0.6
			da*=0.4
			if(abs(da)<0.001) da=0
			acc*=0.2
			-- friction
			local nv,d=v_normz(v)
			v_scale(v,0.9)
			
			if(btn(2)) acc-=1/16
			if(btn(3)) acc+=1/16
		
			v=v_add(v,{sin(angle),-cos(angle)},acc)

			if(btn(0)) da-=1/128
			if(btn(1)) da+=1/128
			angle+=d*da

			local f={-v[2],v[1]}
			v=v_add(v,f,d*da)
			pos=v_add(pos,v)
		end
	}
end

-->8
-- game loop
function _init()
 -- extended memory mode
 poke(0x5f36,16)

 _plyr=make_player({0,0})
 _cam=make_cam()
end

function _update()
	_plyr:update()

	local pos,angle,da=_plyr:orientation()
	_cam:track(pos,angle,8)
 --cy=abs(5*cos(time()/16))
end

function _draw() 
 cls(12)
 _cam:mode7(ground_tex)
 -- backup screen
 poke4(0x8000,peek4(0x0,128*64/4))
 -- screen to ssheet
 poke4(0x0,peek4(0x6000,128*64/4))
 palt(0,false)
	-- draw screen
	local pos,angle,da=_plyr:orientation()
 cls(12)	
	local s=sin(da*2)
	for x=0,127 do
	 sspr(x,0,1,127,x,32+(x-64)*s,1,127)
	end
	palt()
	-- restore spritesheet
	poke4(0x0,peek4(0x8000,128*64/4)) 

	palt(0,false)
	poke(0x5f38,32)
	poke(0x5f39,4)
	poke(0x5f3a,0)
	poke(0x5f3b,0)
	rspr(64,64,136,32,da*2,64*angle)
	palt()

	palt(6,true)
	palt(0,false)
	poke(0x5f38,0)
	poke(0x5f39,0)
	poke(0x5f3a,16)
	poke(0x5f3b,4)
	rspr(64,112,24,16,da*2)

	--sspr(0,106,32,18,55,96)
	--spr(154,58,96,2.5,2)
	palt()
 print(stat(1),2,2,7)
 print(pos[1].."\n"..pos[2],2,8,7)
end


-->8
-- sprite rotation helper
function rspr(x,y,w,h,angle,du)
 local p={{0,0},{w,0},{w,h},{0,h}}
 du=du or 0
 local uv={
  du,0,
  w/8+du,0,
  w/8+du,h/8,
  du,h/8}
 local ca,sa=cos(angle),sin(angle)
 for i,v in pairs(p) do
  local sx,sy=unpack(v)
	-- rotation center is middle
  sx-=w/2
	-- rotation center is base
  sy-=h
  p[i]={ca*sx-sa*sy+x,sa*sx+ca*sy+y}
 end
 tquad(p,uv)
end

-- quad rasterization with tline uv coordinates
function tquad(v,uv)
	local p0,spans=v[4],{}
	local x0,y0,u0,v0=p0[1],p0[2],uv[7],uv[8]
	-- ipairs is slower for small arrays
	for i=1,4 do
		local p1=v[i]
		local x1,y1,u1,v1=p1[1],p1[2],uv[(i<<1)-1],uv[i<<1]
		local _x1,_y1,_u1,_v1=x1,y1,u1,v1
		if(y0>y1) x0,y0,x1,y1,u0,v0,u1,v1=x1,y1,x0,y0,u1,v1,u0,v0
		local dy=y1-y0
		local dx,du,dv=(x1-x0)/dy,(u1-u0)/dy,(v1-v0)/dy
		if(y0<0) x0-=y0*dx u0-=y0*du v0-=y0*dv y0=0
		local cy0=y0\1+1
		-- sub-pix shift
		local sy=cy0-y0
		x0+=sy*dx
		u0+=sy*du
		v0+=sy*dv
		for y=cy0,min(ceil(y1)-1,127) do
			local span=spans[y]
			if span then
				--rectfill(x[1],y,x0,y,offset/16)
				
				local a,au,av,b,bu,bv=span.x,span.u,span.v,x0,u0,v0
				if(a>b) a,au,av,b,bu,bv=b,bu,bv,a,au,av
				local dab=b-a
				local dau,dav=(bu-au)/dab,(bv-av)/dab
				local ca,cb=ceil(a),min(ceil(b)-1,127)
				if ca<=cb then
					-- sub-pix shift
					local sa=ca-a
					tline(ca,y,cb,y,au+sa*dau,av+sa*dav,dau,dav)
				end
			else
				spans[y]={x=x0,u=u0,v=v0}
			end
			x0+=dx
			u0+=du
			v0+=dv
		end
		x0,y0,u0,v0=_x1,_y1,_u1,_v1
	end

	--[[
	local v0,v1,v2,v3=
		v[1],
		v[2],
		v[3],
		v[4]
	line(v0.x,v0.y,v1.x,v1.y,7)
	line(v1.x,v1.y,v2.x,v2.y,7)
	line(v2.x,v2.y,v3.x,v3.y,7)
	line(v3.x,v3.y,v0.x,v0.y,7)
	]]
end
__gfx__
cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc3333333366666666666666667766776600000000
ccccccccccccc77c7ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc7ccc3333333366666666666666667766776600000000
cccccccc7c7c7ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc77c7c7c73333333366666666666776666677667700000000
ccccccccc7c7cccccccccccccccccccc7c7c77ccccccccccccccccccccccccccccccccccccc7c7c7777777773333333366666666666776666677667700000000
cccccccc7c7ccccccccccccccccc77c7c777cc7ccccccccccccccccccccccccccccccccccccccc7c77c777c73333333366666666666776667766776600000000
ccccccccccccccccccccccccc7cccccc777c7777cccccc7ccc7cc7cccccccccccccccccccccccccccccc7c773333333366666666666776667766776600000000
cccccccc6c6c6cc6c7c6c77c7c7c77c7c7c7777c7c7cc7c7c7c7777c7c77c6c6c66c6c6c6cc6c7c6cc7c77c73333333366666666666776666677667700000000
ccccccccc6c7c66c7c6c6cc6c777cc7c7777777777777c7c777667c7c6cc6c6c6cc6c6c6c66c7c7c7777c7773333333366666666666666666677667700000000
ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccbbbbbbbbf67666666666676f7777777700000000
ccccc7c77c7c7c7cccccc7ccccccccccccccccccc7c7ccccccccccccccccccccccccccccccccccccccccccccbbbbbbbbf67666666666676f7777777700000000
cc7c7c777777ccc77c7c7cccccccccccccccc77c7c7c7cc7c7c7ccccccccccccccccccccccccccccccccccccbbbbbbbbf67666666666676f7777777700000000
77c7c7c77c7c7c7cc7c777cc7ccccccccc7c7cc77777c777777c77c7c7ccccccccccccccccccccccccccccccbbbbbbbbf67666666666676f7777777700000000
cc7c77777777c7c777777c77c7c7cc77c7c7c777777c7cc7c7ccccccccccccccccccccccccccccccccccccccbbbbbbbbf67666666666676f7777777700000000
7777777777777777777c77777ccccccccc7c7cc7c7c7ccccccccccccccccccccccccccccccccccccccccccccbbbbbbbbf67666666666676f7777777700000000
77777777777777777777c7cc7c7c6c66c6c6c77c7c6c6cc6c6c6cc6c6c6cc6c6c6c66c6c6c66c6c6c6cc6c7cbbbbbbbbf67666666666676f7777777700000000
77c77777777777777777777777c7c7cc6c6c6cc6c6c6c66c6c6c66c6c6c66c6c6c6cc6c6c6cc6c6c7c77c6c6bbbbbbbbf67666666666676f7777777700000000
cccccccccccccccc767677776766677676767777776766767776677767666666666666666666666666666667bb3bbbb300000000000000000000000000000000
cccccccccccccccc677777767666666767777777767677777767767666666666666666666666676666667666bb333bbb00000000000000000000000000000000
cccccccccccccccc7677777777676776777777677777667777766666666666666666666666666666766767673b333b3300000000000000000000000000000000
cccccccccccccccc7777777676767667676777777777777777677666666666666666666676676767677677773bb33bb300000000000000000000000000000000
cccccccccccccc7c777776677777777777777777677777767676676766677666666666666776777777777767bbbbbbbb00000000000000000000000000000000
cccccccc7cc7c7c7777777777777777777777776777677777767767676766767666676767777777777777777bb3bb33b00000000000000000000000000000000
6cc6c6c6c77c7777767777777767677776767767676766777777777777777776767767677777777777777777bb33b33300000000000000000000000000000000
c66c7c7c6cc7c777676767767676766767666676667677777777777776766766676676667667677777777777bb33b3bb00000000000000000000000000000000
66767677667777777676767667777766767666666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000
77677777777676766767677776777677777767666666666666666666666666666666666666666666666666660000000000000000000000000000000000000000
66777776776666677666667667676766777776776766666666666666666666666666666666666666666666670000000000000000000000000000000000000000
77776766667676766767676777777777777777667676666666666666666666666666666666666666666676770000000000000000000000000000000000000000
77767676777767677777777777677777777677777767677676766666666666767666676766677666767767770000000000000000000000000000000000000000
77777777777777777777777777777777777777777777766767676776767677677767777676766767777777770000000000000000000000000000000000000000
77777777777777777777777777777777777777776767666666767777777766767676676767677776767767770000000000000000000000000000000000000000
77777777777777777777777777777777777777777776766767777777767677676666667666766767676676760000000000000000000000000000000000000000
66667676766767676776777777767666666666666666666767777777767667676777767676666767666676760000000000000000000000000000000000000000
66776767677666767777777767666776767666666667667f76767767676776767676676767777f76666667770000000000000000000000000000000000000000
67777677777767777777777777767667f7676776767f77f7f7f6667676666766676666766f77f7f7f77676770000000000000000000000000000000000000000
7677676777777676777777777777f77f7fff7ff7f7f7777f7fffffff6666667676766667f7ff777f7ff7f7670000000000000000000000000000000000000000
6766777776676777677676777f7f7ffffffff7777f7f77f7ffffffffff66666666677f7f7777f7f7ffffffff0000000000000000000000000000000000000000
777777777777777777777777f7f7f77fff7f7ff7f7ffffff7f7fffffffffff7fff7ff7f7f7ffffffffffffff0000000000000000000000000000000000000000
7777777777777777777777777ffffffff7f7fffffffffffff7f7ff7ffffffff7f7f77f7ffffffff7f77f7fff0000000000000000000000000000000000000000
767767776776767777777767fffff77f7fffffffffffffffff7777f7ffffffff7fffffffffff7f777ff7f7ff0000000000000000000000000000000000000000
777777777777777777777777777777777777777777767777777777777777777767676666667ff7f7666666760000000000000000000000000000000000000000
77777777777777777777767777777767777776776767676676767777777767767676666767f77f7ff67667660000000000000000000000000000000000000000
77777777777777767767777776767676676767666666667767677777777676666667667f7f7777ffff6776760000000000000000000000000000000000000000
6776777777777777777776777767666776767677666767777776766767676776667f777777f77f7ffffff6670000000000000000000000000000000000000000
666767677777777777676767766666766767666666767677676767766676666667f7ff7f7f7ffffffff77f7f0000000000000000000000000000000000000000
ffff7777777777676676767667676667766666666666676676666666676766667f7777f7fff77fff7f7777f70000000000000000000000000000000000000000
ffffff777776767677666766666666666666676676767f77ff67677f7f7f7ff7f7f7fffffffffffff7777f7f0000000000000000000000000000000000000000
fffffffffff76666666666666666666776767f77f7f7ffff7ffffffff7f7f77fff7ffff7ffffffff7f7ff7ff0000000000000000000000000000000000000000
66776667676666767667676767767776ff7ffffffffffffffffffffff7f7ff7fff7ff7fffff33fffff7777f70000000000000000000000000000000000000000
66666676667767666666767777777777ffffffffffffffffffffff7f7f7ffffffffffffff3f333fff7ff7f7f0000000000000000000000000000000000000000
66666666676676767667777777777777ffffffffffffffff3f7f77ffffffffffffffffff3333337f7f77ffff0000000000000000000000000000000000000000
67667666667777777777777777777767ffffffffffffffff30ffffffffffff3fffffffff33333333ffffffff0000000000000000000000000000000000000000
767767676766767777777777777f7776fffffffffffffff3330fff0fff3f333ffffffffff3033330ffffffff0000000000000000000000000000000000000000
fffff676667767676777777f7ff7f7ffffff0ffffff33ff3300f0000fff33333fff00fff303333333ffff0ff0000000000000000000000000000000000000000
7fffffff777777777777f7f7777f7f7f0fff000ffff333330300000300333330fff000fff333303000ff00ff0000000000000000000000000000000000000000
f7ffffffff777777f77f777f7ff7ffff0ff0000fff3f333330003330033033030f3000f330300303030000030000000000000000000000000000000000000000
ffffffffffffffffffffff66776767666666666667f7f7ff777f7fffffffffffff7f7ff7fffffffffffff7f70000000000000000000000000000000000000000
ffffffffffffffffffffffffffff7676676767677f7f7ffff7fffffffffffffff7f7fffffffffffff7f77f3f0000000000000000000000000000000000000000
ffffffffffffffffff7f7f7fffffffffff7f7f7ff7fffffffffffffffffff77f7f7fffffffffffff7f7ffff30000000000000000000000000000000000000000
ffffffffffffffff77f777f7ff7ffffffff7f7fffffffffff7f7ffffff7f7ff7fffffffffffffff7f7fffff30000000000000000000000000000000000000000
fffffffffff3f7f7ff7f7fffffffffffff7f7fffffffffffff7fff77fffffffffffff33ffff7ff7fffffff330000000000000000000000000000000000000000
fffffffffff333ff77ffffffffffff7ff7ffffffffff7f77fffffffffffffffffff3f33ffffffffffff33f330000000000000000000000000000000000000000
fffffffff33333fffffffffffff7f7ffffffffffffffffffffffffff0ffffffff0f33333fffffffffffff3330000000000000000000000000000000000000000
f33fff03333330ffffffffff33fffffffffff3ffffffffffffffff000fffffff00f333303ff0ffff0ff333300000000000000000000000000000000000000000
f7ffffff7ffffff7f7ff7f7f7777f7f7ffff7f7f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3fffffffffffffff7f77f7f7f77ffffffffff7f70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3ffffffffffff7f7ffffff7ffffff7ffffff7f7f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
333ffffff7fffffffffff7ffffffff3f7ff7f7ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
333fffffffffffff0fff7f7ffffff33ff77f0fff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33033ffffffffff00f77ffff0ff3f3333fff00ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03300ff0fffffff000fffff000033333333000ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
303000f00fff0f000033fff0000033303000000f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666000000000000000000000000
66666666577777777566666666666666665777777775666666666666666665777777775666666666666666665777777775666666000000000000000000000000
66666666855555555866666666666666668555555558666666666666666668555555558666666666666666668555555558666666000000000000000000000000
66666665877777777856666666666666658777777778566666666666666658777777778566666666666666658777777778566666000000000000000000000000
66666660858788785806666666666666608587887858066666666666666608587887858066666666666666608587887858066666000000000000000000000000
66666558500000000585566666666665585000000005855666666666665585000000005855666666666665585000000005855666000000000000000000000000
66666005000077000050066666666660050000770000500666666666660050000770000500666666666660050000770000500666000000000000000000000000
66666688777788777788666666666666887777887777886666666666666887777887777886666666666666887777887777886666000000000000000000000000
66766970577777777507966766666669707777777777079666666666669705777777775079666666666669705777777775079666000000000000000000000000
66667080777000077708076666676667800770000770087666766666660800770000770080666666666660800770000770080666000000000000000000000000
66666337755555555773366666666663377555555557733666666666663377555555557733666666666663377555555557733666000000000000000000000000
66767533777777777733576766666667377777777777737666666666665337777777777335666666666665337777777777335666000000000000000000000000
66666757877888877875766666667670578778888778750767666666760578778888778750676666666660578778888778750666000000000000000000000000
66767875755555555757876766676667875555555555787666766666668855555555555588666666666668855555555555588666000000000000000000000000
67676787000000000078767676667678787000000007878767666676667880000000000887666766666668880000000000888666000000000000000000000000
66767670700000000707676766676767070000000000707676766667676707000000007076767666666666000000000000006666000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666000000000000000000000000000000000000000000000000
66666638575777777766666666666637877757777776666666666663787775777777666666666666077708880555099903330000000000000000000000000000
66666757758555555576666666666755575585555557666666666675557558555555766666666666077708880555099903330000000000000000000000000000
66666505788777777776666666667000057887777777666666666700005788777777766666666666077708880555099903330000000000000000000000000000
66667000788578787856666666665000007885787878566666666500000788578787856666666666077708880555099903330000000000000000000000000000
66557000880000000008666666570005008850000000566666657000500885000000056666666666077708880555099903330000000000000000000000000000
66000058050000770005666666000005058050000700566666600000505805000070056666666666077708880555099903330000000000000000000000000000
66377880887777887778666667337778880887777877866666733777888088777787786666666666077708880555099903330000000000000000000000000000
66507779975777777757966635330777779975777777796663533077777997577777777666666666077708880555099903330000000000000000000000000000
66505500080770000708066650770758300080777007806665077075837008077700780667666766077708880555099903330000000000000000000000000000
66058033377555555557366605037583033377555555736660503758303337755555573666666666077708880555099903330000000000000000000000000000
66080505337777777773366657087730505337777777336665708773057573777777733767666666077708880555099903330000000000000000000000000000
66080700578778888785066607003870700578778887856660700387070057877888785666767666077708880555099903330000000000000000000000000000
66000708855555555555866600000080708855555555586660000078077875555555558767666766000000000000000000000000000000000000000000000000
66600008888000000088866666000000008888000000886666600007070787800000087676767666077777777777777777770000000000000000000000000000
66666000000000000000666666666000000000000000066666666670707070000000006767676766077777777777777777770000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666000000000000000000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000
66666666378777577777766666666666666666666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000
66666667555755855555576666666666666666666666733788776756666666666637777733875786666666637777773666660000000000000000000000000000
66666670000578877777776666666666666666666607777555577888666666666755555737000585666666575555557566660000000000000000000000000000
66666650000078857878785666666666666666666057500000057888666666665077070570000088666666750707705766660000000000000000000000000000
66665700050088500000005666666666666666660570000005000788666666660000000070000078666665700000000756660000000000000000000000000000
66660000050580500007005666666666666666600555000005000888666666550000000055005087666557000000000075560000000000000000000000000000
66673377788808877778778666666666666667335700000005008870666666050000000000005587866000000000000000060000000000000000000000000000
66353307777799757777777966666766666733773757777878888778566666377777773330058877966603377777777330660000000000000000000000000000
66507707587000707770078766676666668877333377077777777779766668778887888373777730866078877888877887060000000000000000000000000000
66050375830333775555557366666666667393333777077750005750866677877778775733078300366357787777778775360000000000000000000000000000
66570877707053777777773766676766655700005777777500500533066677500005779307077305056797755000055779760000000000000000000000000000
66070038707705787788878566766666657005500577778005750033366750050050057050778807086075500500500557060000000000000000000000000000
66000000707078755555555767676766635007700877887005770085766577777777775070530007086057777777777775060000000000000000000000000000
66660007070787880000008876767676600007500888888000750008066038705507837070800000066007387055078370060000000000000000000000000000
66666660707070700000000767676766660000000000000000000008666000000000000000000006666000000000000000060000000000000000000000000000
66666666666666666666666666666666660000000000000000000000666660000000000000006666666600000000000000660000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666660000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777000007770700070707770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000070700070707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000770777077707770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000070707000707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777007007770777000707770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777000007770777077707770007077000000777070007070777000000000000000000000000000000000000000000000000000000000000000000000000000
00707000007070007000707070070007000000007070007070707000000000000000000000000000000000000000000000000000000000000000000000000000
00707000007770777077707770070007000000777077707770777000000000000000000000000000000000000000000000000000000000000000000000000000
00707000007070700070000070070007000000700070700070707000000000000000000000000000000000000000000000000000000000000000000000000000
00777007007770777077700070700077700700777077700070777000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33335555533375511b3b1315573b175511131b33157313555555771b31b31bb55538333b3555b33855b311b3b15583335553b555551573b33155555557b85513
b8555583b3bb3855557bb33bb313b33bb1855557b333b1185587811bb131bb33555555555731bb1375515711bb3b33b1bb31375555733b31375151571313bb3b
551558bb3b33b111b3b31313bb13885555558833b33b3b188555555783bb33b333b131b33331bb1855555578b1b333bb1885555878873133bb1313bb33355515
3b1b33333b88778885555155551555555771b1b1bb3b31b31388b13b3b33bbb1311b13335555555551555555555551555155773b33111bb1b337715555115883
bb1b3333333b133b133b3b55551555888b1b3b3333311b1118855555555515773b131b3b333b1313131b1b333b3333bb3b3318855555555555778b3b1b3b33b3
55555155555577755151551551588881b13333333bbbb3bbb8885555555515555888b1b33b33333bb1bb111bb133b331bb331331b3b113bb8885551555515555
1b113188885555555555551177773b1133133bb3333bb13133777855115555555555777733bb311bb1133bb1b1333331333bbbb33bbbb3bb33bb331b33377885
b8888555555555555555588888bb3333bb333333bb33bbb33118888555555555555555557777bb33bb1b33bb33bbb331133331131bb33bbbb333b3333333bb11
55555555555515555557888bbb1133bbb33b333333b1bbb113388888555555555555555115577777331133311b3bbb33bbbbb113313311333bb11bbb3333bbb3
55555555555555557777711bbbbbb11bbb1b333bbb33111bbb3377777555111551155155515555777777bbbbb113331bb11bbb113333333333333333311bb333
555511115555588888333111bbb33311133311133bbb111333bbb888887555551155155511555115558888833333333333333333311bbb333bb1333111bb3bbb
555551115577777733b1113331113333bbb333333bbb11133133337777785555511155555555555555555777777333bbb3333111bbb111b33bbb111bb1133333
55155558888888111bb133333333331333333bbbbbbb333bbbb1bb88888885555555555555551111555555558888888bb1bbbb333bbb33333333333bbb1111bb
555577777771111bbb11113111bbb1111bb33bbb33333331bbb333377777775555111155555555555555115555558887777bbbb1113111333311133117777777
577778888bbbb3333b33bbbb3333bbb33333bbbb3333bbbb33333333788888885551115555555555555555555555555777777771111b333bbbb111bbb3bbbb77
888888333333331bbbb33333333333311111bbbb33bb111133331111888888888555555555555555555555555555555555888888888bbbb33333333bbbb33555
777733331111133333333311113111bbbbb3333bbb11bbbb33333bbbb7777777775555555555d655555555551111116555555588888888333335515555555555
733333bbbbb333311111bbbbb111bb3333bbbbb11111111133333333337777777775555555d11555555555555551115555555555585555555555555555555511
bbbb11111333331bbbb33333bbbbb3333333333bbbbb111bb11111333337777788885555555511115555555555555555555555555555555555511155d5555555
b1bbbbb33333bbbbb333333333333333333bbb111111bbbbb1111b11111888888888885511555555555555555555555555555555551155555555511d11555155
bbbbb3333333333333333333333333333bbbbb111bb333333bbbbb1111118888888888855555555555555555555555551111d555555555555555555511111155
111333333333333111113333333333bb111111bbbbb333333333333bbbbbb8888888777755555555555555511111555555111111555555155555555555551555
b111111333333111111111111bbbbbb111111bb3333333333333333bbbb3377777777777755555555511155555555555555555555555511111155555555d55d5
111111331111bbbbbb111111bbbbb33bbbbbb3333333333331bbbbbb3333337777777777777555555111111555d555555d555555555555551115555555555555
bbbb1111111bbbbbb1bbbbbb333333bbbbbbb3333331111111bbbbbb3333333777777777777755555511111115dd555111155555511115555555555555555555
bb111111b3333333bbbbbbb3333333bbbbbb33333331111111bbb3333333333777777777777885555555111115155555515555555d6d555555555555555555dd
3bbbbbbb3333333bbbbbb33333333bbbbbbb33333331bbbbbb33333333333333777888888888885555555111111555555d555555555555555555555555555555
bbbbbb3333333333333333333333bbbbbbbb3333333bbbbbbb333333333311111888888888888888555555555555555555555555555555555555555555555555
bb33333333333333333333333331bbbbbbb33333333bbbbbbb333333331111111188888888888888855dd5555555555555555555551115555555555555555555
333333333333333333311111111bbbbbbbb33333333b1111111333333311111111888888888888888855565555555555555555555555d5555555555555555155
333333333333333333111111111bbbbbbbb33bbbbbb11111111333333331111bbbb88888888888888885555555555555555555555555d55555555555555555dd
33111111133333333311111111bbb33333bbbbbbbbb1111111133333333bbbbbbbbb888888888888888875555555555555555111155555551155555555555111
111111113333333331111bbbb333333333bbbbbbbbb1111111b333333333bbbbbbbb888888888877777777555555555555555551111555551111555555555111
1111111333333311bbbbbbbbb333333333bbbbbbbbbbbbbbbbb333333333bbbbbbbbb88877777777777777755555555555555555555515155511555555555551
111111111111111bbbbbbbbb333333333bbb111111bbbbbbbbbb333333333bbbbb33337777777777777777775555555515555115555555d55555555555555555
bbbbb111111111bbbbbbbbbb33333bbbb111111111bbbbbbbbbb3333333333333333333777777777777777777555551111155dd6655555555555555555555555
bbbb111111111bbbbbbbbb3bbbbbbbbbb111111111bbbbbbbbbb333333333333333333377777777777777777777555511111555555555555555d5555555555d5
bb1111111111bbbb333333bbbbbbbbbb1111111111bbbbbb111133333333333333333333777777777777777777775555555555d5555555555511151555555555
b11111111bbb3333333333bbbbbbbbbb1111111111111111111133333333333333333333377777777777777777777555555555555555d111111555d555555555
11bbbbbbbbb3333333333bbbbbbbbbbb1111bbbbbb111111111113333333333333333333377777777777777777777755555555555555551111111d6d55555555
bbbbbbbbbb33333333333bbbbbbbbb3bbbbbbbbbbb11111111111333333333333333333333777777777777777777777755555555555555551111111116d55555
bbbbbbbbb33333333333bbbb3333333bbbbbbbbbbb11111111111333333311113333333333377777777777777777777775555555555555555111111111115555
bbbbbbbb33333333333333333333333bbbbbbbbbbb11111111111331111111113333333333337777777777777777888888555555555555555551115111511155
bbbbbbb33333333333333333333333bbbbbbbbbbbb11111111bbb111111111111333333333337777777777778888888888855555555555555555111111111155
bbbbbb333333333333333333333333bbbbbbbbbbbb111bbbbbbbb111111111111333333333333777777788888888888888888555555555555555551111155555
b33333333333333333333333333333bbbbbbbbbb11bbbbbbbbbbbb11111111111133333333333377888888888888888888888855555555555555555555555555
33333333333333333333333333333bbbbbb1111111bbbbbbbbbbbb11111111111133333333311188888888888888888888888885555555555555555555555555
33333333333333333333333333333b11111111111bbbbbbbbbbbbb11111111111113333111111118888888888888888888888888555555555555555555555555
3333333333333333333333333bbbb111111111111bbbbbbbbbbbbb11111111111111111111111111888888888888888888888888885555555515555555555555
33333333333333333333bbbbbbbb1111111111111bbbbbbbbbbbbb11111111bbbbb1111111111111888888888888888888888888888555555111555555555555
333333333333333bbbbbbbbbbbbb1111111111111bbbbbbbbbbbbbb111bbbbbbbbbb111111111111188888888888888888888888888855555d55555555555555
33333333333333bbbbbbbbbbbbbb1111111111111bbbbbbbbbbbbb3bbbbbbbbbbbbb1111111111111188888888888888888888888888855ddddd555dd5555555
3333333333333bbbbbbbbbbbbbb11111111111111bbbbbbbbb33333bbbbbbbbbbbbbb1111111111111188888888888888888888888888855d56dd5d555555555
3333333333333bbbbbbbbbbbbbb11111111111111bbbb3333333333bbbbbbbbbbbbbb11111111111111888888888888888888888888888885555566d55555555
333333333333bbbbbbbbbbbbbbb1111111111111133333333333333bbbbbbbbbbbbbbb1111111111111188888888888888888888888888888555555555555555
333333333333bbbbbbbbbbbbbb11111111111bbbb333333333333333bbbbbbbbbbbbbb1111111111111118888888888888888888888888888855555555555555
33333333333bbbbbbbbbbbbbbb1111111bbbbbbbb333333333333333bbbbbbbbbbbbbbb11111111111bbb8888888888888888888888888888885555555555555
3333333333bbbbbbbbbbbbbbbb111bbbbbbbbbbbb333333333333333bbbbbbbbbbbbbbb11111111bbbbbbb888888888888888888888888888888855555555555
3333333333bbbbbbbbbbbbbb1bbbbbbbbbbbbbbbb333333333333333bbbbbbbbbbbbbbb1111bbbbbbbbbbbb88888888888888888888888888888885555555888
333333333bbbbbbbbbbb11111bbbbbbbbbbbbbbbb333333333333333bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb8888888888888888888888888888888555588888
333333333bbbbbbb111111111bbbbbbbbbbbbbbb3333333333333333bbbbbbbbbbbb3333bbbbbbbbbbbbbbbb8888888888888888888888888888888858888888
33333333bbbb111111111111bbbbbbbbbbbbbbbb33333333333333333bbbbbbbb33333333bbbbbbbbbbbbbbbb888888888888888888888888888883333888888
333333311111111111111111bbbbbbbbbbbbbbbb33333333333333333bbbbb33333333333bbbbbbbbbbbbbbbbb88888888888888888888888888333333388888

__map__
0102030405060708090a101101131415161718191a202105060708090a10111213191a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22232425262728292a303132333435363738393a404142262728292a30313233343535000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
434445464748494a505152535455565758595a606162634748494a5051525354555656000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6465666768696a707172737475767778797a808182838468696a70717273696a707172000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b1b0b1b0b1b1c0c0d0c1d1b0b1b0b1b9a9b9c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b0b1b0b1b0b1c0c0c0c1d0b1b0b1b0baaabac00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b1b0b1b0b1b1c0c0d0c1d1b0b1b0b1b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b0b1b0b1b0b1c0c0c0c1d0b1b0b1b0b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
